AddDefaultCharset UTF-8
<IfModule mod_rewrite.c>
    RewriteEngine On

    # --------------------------------------------------
    # Allow index.php
    <Files "index.php">
        Require all granted
    </Files>

    # --------------------------------------------------
    # Deny access to sensitive directories
    RedirectMatch 403 ^/(app|scheme|console|runtime)/

    # --------------------------------------------------
    # Deny access to sensitive files
    <FilesMatch "\.(env|json|xml|log|md|lock|git|ini|bak|sql)$">
        Require all denied
    </FilesMatch>

    # --------------------------------------------------
    # Prevent directory browsing
    Options -Indexes

    # --------------------------------------------------
    # Handle SPA routes for /ui/ folder - redirect to ui/index.html
    # This handles all /ui/* routes including those with query strings
    RewriteCond %{REQUEST_URI} ^/ui
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^ui(/.*)?$ /ui/index.html [QSA,L]

    # --------------------------------------------------
    # Route all other requests through index.php (LavaLust backend)
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteCond %{REQUEST_URI} !^/ui
    RewriteRule ^(.*)$ index.php/$1 [QSA,L]
</IfModule>
